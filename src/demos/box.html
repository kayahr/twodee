<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>ThreeDee demo: Box</title>
    <script src="../main/javascript/twodee.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/Object.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/math/Vector.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/math/Matrix.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/model/Color.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/model/Polygon.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/model/Model.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/model/Box.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/output/RenderOptions.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/updater/NodeUpdater.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/updater/RotateUpdater.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/updater/KeyboardUpdater.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/rendering/FpsCounter.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/rendering/Line.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/rendering/RenderPolygon.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/rendering/RenderModel.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/rendering/PolygonBuffer.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/SceneNode.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/ModelNode.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/TextNode.js" type="text/javascript"></script>
    <script src="../main/javascript/twodee/scene/Scene.js" type="text/javascript"></script>
    <script type="text/javascript">
    /* <![CDATA[ */

    var renderOptions = new twodee.RenderOptions();
    renderOptions.fpsInfo = true;
    renderOptions.debugInfo = true;

    // Creates the root node
    var rootNode = new twodee.SceneNode();

    for (x = -2; x <= 2; x++)
    {
        for (y = -2; y <= 2; y++)
        {
            var box = new twodee.Box(20);
            var boxNode = new twodee.ModelNode(box);
            boxNode.getTransform().translate(x * 60, y * 60);
            boxNode.setCollidable(true);
            rootNode.appendChild(boxNode);
            if (x || y)
            {
                var rotateUpdater = new twodee.RotateUpdater(45 * Math.PI / 180);   
                boxNode.addUpdater(rotateUpdater);
            }
            else
            {
                var keyboardUpdater = new twodee.KeyboardUpdater();
                boxNode.addUpdater(keyboardUpdater);                
            }
        }
    }

    // Create the scene
    var scene = new twodee.Scene();    
    scene.setRootNode(rootNode);
    
    // The graphics context and the elements canvas
    var g, elementsCanvas;

    function init()
    {
        var canvas;
        
        canvas = document.getElementById("canvas");
        elementsCanvas = document.getElementById("elementsCanvas");
        g = canvas.getContext("2d");
        setInterval(render, 0);
    }

    function render()
    {
        var canvas, width, height;
        
        canvas = g.canvas;
        width = canvas.width;
        height = canvas.height;

        g.clearRect(0, 0, width, height);

        scene.update(); 
        scene.render(g, elementsCanvas, width, height, renderOptions);

        document.getElementById("debugInfo").innerHTML = scene.getDebugInfo();
    }
    
    /* ]]> */
    </script>
  </head>
  <body onload="init()">
    <h1>TwoDee demo: Square</h1>
    <p>
      This demo shows a simple rotating square. 
    </p>
    <hr />
    <div style="position:relative">
      <div id="elementsCanvas" style="position:absolute;left:0;top:0;width:480px;height:100%;overflow:hidden"></div>
      <canvas id="canvas" width="480" height="320" style="background:black"></canvas>
      <pre id="debugInfo" style="position:absolute;left:5px;top:5px;font-size:12px;color:#0f0;margin:0"></pre>     
    </div>
    <hr />
    <p>
      Copyright (C) 2009 Klaus Reimer
    </p>
  </body>
</html>
